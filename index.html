<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√ºsseldorf Flughafen - Live Flugdaten</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            margin: 0;
            padding: 0;
            background: #f8fafc;
        }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); }
        .live-indicator { animation: blink 2s infinite; }
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0.5; } }
        .debug-info { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-size: 12px; z-index: 1000; max-width: 300px; }
    </style>
</head>
<body>
    <div id="debug-info" class="debug-info" style="display: none;">
        <div id="debug-content"></div>
    </div>
    <div id="root">
        <div style="padding: 20px; text-align: center;">
            <h1>üõ´ DUS Flughafen</h1>
            <p>L√§dt...</p>
            <div style="margin-top: 20px;">
                <div style="width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            </div>
        </div>
    </div>

    <script type="text/babel">
        // Debug-Funktionen
        const debugLog = (message, data = null) => {
            console.log(`[DUS DEBUG] ${message}`, data);
            const debugDiv = document.getElementById('debug-content');
            if (debugDiv) {
                const time = new Date().toLocaleTimeString();
                debugDiv.innerHTML += `<div>${time}: ${message}</div>`;
                if (data) debugDiv.innerHTML += `<pre>${JSON.stringify(data, null, 2).slice(0, 200)}...</pre>`;
            }
        };

        // Debug-Info anzeigen (f√ºr Entwicklung)
        const showDebug = () => {
            document.getElementById('debug-info').style.display = 'block';
        };

        // Error Handler
        window.addEventListener('error', (e) => {
            debugLog(`JavaScript Error: ${e.message}`, { file: e.filename, line: e.lineno });
        });

        debugLog('App wird initialisiert...');

        const { useState, useMemo, useEffect, useCallback } = React;
        
        // Lucide Icons korrekt laden
        const Plane = lucide.Plane;
        const Star = lucide.Star;
        const Search = lucide.Search;
        const Clock = lucide.Clock;
        const MapPin = lucide.MapPin;
        const RefreshCw = lucide.RefreshCw;
        const Wifi = lucide.Wifi;
        const WifiOff = lucide.WifiOff;
        const Users = lucide.Users;
        const AlertCircle = lucide.AlertCircle;
        const Filter = lucide.Filter;
        const ChevronDown = lucide.ChevronDown;
        const ChevronUp = lucide.ChevronUp;
        const X = lucide.X;
        const CheckCircle = lucide.CheckCircle;
        const Signal = lucide.Signal;
        const Globe = lucide.Globe;

        // Mock-Daten f√ºr Demo/Fallback
        const generateMockFlights = () => {
            debugLog('Generiere Mock-Flugdaten...');
            
            const airlines = ['Lufthansa', 'Eurowings', 'Air France', 'KLM', 'Turkish Airlines', 'British Airways', 'Ryanair', 'Emirates'];
            const destinations = [
                { city: 'London Heathrow', code: 'LHR', country: 'United Kingdom' },
                { city: 'Paris CDG', code: 'CDG', country: 'France' },
                { city: 'Madrid', code: 'MAD', country: 'Spain' },
                { city: 'Rom Fiumicino', code: 'FCO', country: 'Italy' },
                { city: 'Amsterdam', code: 'AMS', country: 'Netherlands' },
                { city: 'Wien', code: 'VIE', country: 'Austria' },
                { city: 'Z√ºrich', code: 'ZUR', country: 'Switzerland' },
                { city: 'Istanbul', code: 'IST', country: 'Turkey' },
                { city: 'New York JFK', code: 'JFK', country: 'United States' },
                { city: 'Dubai', code: 'DXB', country: 'United Arab Emirates' },
                { city: 'Athen', code: 'ATH', country: 'Greece' },
                { city: 'Barcelona', code: 'BCN', country: 'Spain' }
            ];

            const flights = [];
            const now = new Date();

            // Ank√ºnfte
            for (let i = 0; i < 12; i++) {
                const destination = destinations[Math.floor(Math.random() * destinations.length)];
                const airline = airlines[Math.floor(Math.random() * airlines.length)];
                const flightNumber = `${airline.substring(0, 2).toUpperCase()}${Math.floor(Math.random() * 9000) + 1000}`;
                
                const scheduledTime = new Date(now.getTime() + (Math.random() - 0.5) * 4 * 60 * 60 * 1000);
                const delay = Math.random() > 0.8 ? Math.floor(Math.random() * 60) + 5 : null;

                flights.push({
                    id: `arr_${i}`,
                    flugnummer: flightNumber,
                    airline: airline,
                    herkunft: destination.city,
                    herkunftCode: destination.code,
                    ankunft: scheduledTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }),
                    gate: `${['A', 'B', 'C'][Math.floor(Math.random() * 3)]}${Math.floor(Math.random() * 20) + 1}`,
                    status: ['Aktiv', 'Anflug', 'Gelandet', 'Versp√§tet'][Math.floor(Math.random() * 4)],
                    statusColor: ['text-blue-600', 'text-orange-600', 'text-green-600', 'text-red-600'][Math.floor(Math.random() * 4)],
                    versp√§tung: delay,
                    passagiere: Math.floor(Math.random() * 200) + 50,
                    isLanding: true,
                    land: destination.country,
                    altitude: Math.floor(Math.random() * 30000) + 5000,
                    velocity: Math.floor(Math.random() * 400) + 150
                });
            }

            // Abfl√ºge
            for (let i = 0; i < 12; i++) {
                const destination = destinations[Math.floor(Math.random() * destinations.length)];
                const airline = airlines[Math.floor(Math.random() * airlines.length)];
                const flightNumber = `${airline.substring(0, 2).toUpperCase()}${Math.floor(Math.random() * 9000) + 1000}`;
                
                const scheduledTime = new Date(now.getTime() + Math.random() * 4 * 60 * 60 * 1000);

                flights.push({
                    id: `dep_${i}`,
                    flugnummer: flightNumber,
                    airline: airline,
                    zielort: destination.city,
                    zielCode: destination.code,
                    abflug: scheduledTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }),
                    gate: `${['A', 'B', 'C'][Math.floor(Math.random() * 3)]}${Math.floor(Math.random() * 20) + 1}`,
                    status: ['Geplant', 'Boarding', 'Gestartet', 'Versp√§tet'][Math.floor(Math.random() * 4)],
                    statusColor: ['text-blue-600', 'text-orange-600', 'text-green-600', 'text-red-600'][Math.floor(Math.random() * 4)],
                    versp√§tung: Math.random() > 0.8 ? Math.floor(Math.random() * 60) + 5 : null,
                    isLanding: false,
                    land: destination.country
                });
            }

            debugLog(`${flights.length} Mock-Fl√ºge generiert`);
            return flights;
        };

        const FlugInfoApp = () => {
            const [activeTab, setActiveTab] = useState('ank√ºnfte');
            const [searchTerm, setSearchTerm] = useState('');
            const [favorites, setFavorites] = useState([]);
            const [flights, setFlights] = useState([]);
            const [loading, setLoading] = useState(true);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [error, setError] = useState(null);
            const [showSearch, setShowSearch] = useState(false);
            const [selectedFlightsForControl, setSelectedFlightsForControl] = useState(new Set());
            const [selectedAirports, setSelectedAirports] = useState(new Set());
            const [showFilters, setShowFilters] = useState(false);
            const [bemerkungen, setBemerkungen] = useState({});
            const [dataSource, setDataSource] = useState('mock');

            // Flugh√§fen f√ºr Sichtkontrollen
            const DEFAULT_SICHTKONTROLL_AIRPORTS = {
                'ATH': 'Athen', 'SKG': 'Thessaloniki', 'HER': 'Heraklion', 'RHO': 'Rhodos',
                'MAD': 'Madrid', 'BCN': 'Barcelona', 'PMI': 'Palma', 'AGP': 'M√°laga',
                'LPA': 'Las Palmas', 'VLC': 'Valencia',
                'FCO': 'Rom Fiumicino', 'MXP': 'Mailand Malpensa', 'NAP': 'Neapel',
                'VCE': 'Venedig', 'BLQ': 'Bologna', 'CTA': 'Catania',
                'CDG': 'Paris CDG', 'ORY': 'Paris Orly', 'NCE': 'Nizza',
                'LYS': 'Lyon', 'MRS': 'Marseille',
                'LIS': 'Lissabon', 'OPO': 'Porto', 'FAO': 'Faro',
                'WAW': 'Warschau', 'KRK': 'Krakau', 'GDN': 'Danzig'
            };

            const NON_SCHENGEN_COUNTRIES = [
                'United States', 'Canada', 'United Kingdom', 'Turkey', 'Russia', 
                'China', 'Japan', 'India', 'Thailand', 'United Arab Emirates',
                'Qatar', 'Kuwait', 'Saudi Arabia', 'Egypt', 'Morocco', 'Tunisia',
                'Serbia', 'Bosnia and Herzegovina', 'North Macedonia', 'Albania',
                'Ukraine', 'Belarus', 'Moldova'
            ];

            // OpenSky API versuchen
            const fetchOpenSkyData = async () => {
                debugLog('Versuche OpenSky API...');
                
                try {
                    const DUS_LAT = 51.2895;
                    const DUS_LON = 6.7668;
                    const url = `https://opensky-network.org/api/states/all?lamin=${DUS_LAT - 0.5}&lomin=${DUS_LON - 0.5}&lamax=${DUS_LAT + 0.5}&lomax=${DUS_LON + 0.5}`;
                    
                    debugLog('OpenSky URL:', url);
                    
                    const response = await fetch(url);
                    debugLog('OpenSky Response Status:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    debugLog('OpenSky Data received:', { states_count: data.states?.length || 0 });
                    
                    if (!data.states || data.states.length === 0) {
                        throw new Error('Keine Flugdaten im Bereich');
                    }
                    
                    // Daten verarbeiten
                    const processedFlights = [];
                    data.states.forEach((state, index) => {
                        if (index < 20) { // Limit f√ºr Demo
                            const [icao24, callsign, origin_country, time_position, last_contact, longitude, latitude, baro_altitude, on_ground, velocity] = state;
                            
                            if (callsign && longitude && latitude) {
                                const cleanCallsign = callsign.trim();
                                const isLanding = Math.random() > 0.5; // Zuf√§llig f√ºr Demo
                                
                                const estimatedTime = new Date();
                                estimatedTime.setMinutes(estimatedTime.getMinutes() + Math.floor(Math.random() * 60));
                                
                                const destinations = ['London', 'Paris', 'Madrid', 'Rom', 'Amsterdam'];
                                const randomDest = destinations[Math.floor(Math.random() * destinations.length)];
                                
                                const flight = {
                                    id: icao24,
                                    flugnummer: cleanCallsign,
                                    airline: origin_country || 'Unbekannt',
                                    isLanding: isLanding,
                                    status: on_ground ? 'Gelandet' : velocity > 200 ? 'Aktiv' : 'Anflug',
                                    statusColor: on_ground ? 'text-green-600' : velocity > 200 ? 'text-blue-600' : 'text-orange-600',
                                    gate: `${['A', 'B', 'C'][Math.floor(Math.random() * 3)]}${Math.floor(Math.random() * 20) + 1}`,
                                    altitude: Math.round(baro_altitude || 0),
                                    velocity: Math.round(velocity || 0),
                                    land: origin_country || 'Unbekannt'
                                };
                                
                                if (isLanding) {
                                    flight.herkunft = randomDest;
                                    flight.herkunftCode = randomDest.substring(0, 3).toUpperCase();
                                    flight.ankunft = estimatedTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                                    flight.passagiere = Math.floor(Math.random() * 200) + 50;
                                } else {
                                    flight.zielort = randomDest;
                                    flight.zielCode = randomDest.substring(0, 3).toUpperCase();
                                    flight.abflug = estimatedTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                                }
                                
                                processedFlights.push(flight);
                            }
                        }
                    });
                    
                    debugLog(`${processedFlights.length} Fl√ºge verarbeitet`);
                    return processedFlights;
                    
                } catch (error) {
                    debugLog('OpenSky Fehler:', error.message);
                    throw error;
                }
            };

            const loadFlightData = useCallback(async () => {
                debugLog('Lade Flugdaten...');
                setLoading(true);
                setError(null);
                
                try {
                    // Erst OpenSky versuchen
                    try {
                        const realFlights = await fetchOpenSkyData();
                        if (realFlights.length > 0) {
                            setFlights(realFlights);
                            setDataSource('opensky');
                            setLastUpdate(new Date());
                            debugLog('‚úÖ OpenSky Daten geladen');
                            return;
                        }
                    } catch (openskyError) {
                        debugLog('OpenSky fehlgeschlagen, nutze Mock-Daten');
                    }
                    
                    // Fallback: Mock-Daten
                    const mockFlights = generateMockFlights();
                    setFlights(mockFlights);
                    setDataSource('mock');
                    setLastUpdate(new Date());
                    debugLog('‚úÖ Mock-Daten geladen');
                    
                } catch (error) {
                    debugLog('Fehler beim Laden der Flugdaten:', error.message);
                    setError(`Daten nicht verf√ºgbar: ${error.message}`);
                    setFlights([]);
                } finally {
                    setLoading(false);
                }
            }, []);

            useEffect(() => {
                debugLog('useEffect: App initialisiert');
                loadFlightData();
                setSelectedAirports(new Set(Object.keys(DEFAULT_SICHTKONTROLL_AIRPORTS)));
                
                // Auto-refresh alle 60 Sekunden
                const interval = setInterval(() => {
                    debugLog('Auto-refresh...');
                    loadFlightData();
                }, 60000);
                
                return () => {
                    debugLog('Cleanup interval');
                    clearInterval(interval);
                };
            }, [loadFlightData]);

            const toggleFavorite = (flugId) => {
                setFavorites(prev => 
                    prev.includes(flugId) 
                        ? prev.filter(id => id !== flugId)
                        : [...prev, flugId]
                );
            };

            const isFavorite = (flugId) => favorites.includes(flugId);

            const updateBemerkung = (flugId, bemerkung) => {
                setBemerkungen(prev => ({
                    ...prev,
                    [flugId]: bemerkung
                }));
            };

            const getBemerkung = (flugId) => bemerkungen[flugId] || '';

            const toggleFlightForControl = (flugId) => {
                setSelectedFlightsForControl(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(flugId)) {
                        newSet.delete(flugId);
                    } else {
                        newSet.add(flugId);
                    }
                    return newSet;
                });
            };

            const toggleAirportForControl = (airportCode) => {
                setSelectedAirports(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(airportCode)) {
                        newSet.delete(airportCode);
                    } else {
                        newSet.add(airportCode);
                    }
                    return newSet;
                });
            };

            const getArrivingFlights = () => {
                return flights.filter(flight => flight.isLanding);
            };

            const isNonSchengenCountry = (country) => {
                return NON_SCHENGEN_COUNTRIES.includes(country);
            };

            const filteredFlights = useMemo(() => {
                if (!flights.length) return [];
                
                let filteredList = [];
                
                if (activeTab === 'abfl√ºge') {
                    filteredList = flights.filter(flight => !flight.isLanding);
                } else if (activeTab === 'ank√ºnfte') {
                    filteredList = flights.filter(flight => flight.isLanding);
                } else if (activeTab === 'sichtkontrollen') {
                    const airportSelectedFlights = flights.filter(flight => 
                        flight.isLanding && 
                        flight.herkunftCode &&
                        selectedAirports.has(flight.herkunftCode)
                    );
                    
                    const manuallySelectedFlights = flights.filter(flight =>
                        selectedFlightsForControl.has(flight.id)
                    );
                    
                    const combinedFlights = [...airportSelectedFlights];
                    manuallySelectedFlights.forEach(flight => {
                        if (!combinedFlights.find(f => f.id === flight.id)) {
                            combinedFlights.push(flight);
                        }
                    });
                    
                    filteredList = combinedFlights;
                } else if (activeTab === 'favoriten') {
                    filteredList = flights.filter(flight => favorites.includes(flight.id));
                }
                
                if (!searchTerm) return filteredList.slice(0, 30);
                
                return filteredList.filter(flight => 
                    flight.flugnummer.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (flight.zielort && flight.zielort.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (flight.herkunft && flight.herkunft.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (flight.zielCode && flight.zielCode.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (flight.herkunftCode && flight.herkunftCode.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    flight.airline.toLowerCase().includes(searchTerm.toLowerCase())
                ).slice(0, 30);
            }, [activeTab, searchTerm, favorites, flights, selectedFlightsForControl, selectedAirports]);

            const FlugKarte = ({ flug }) => (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 mb-4 p-4 card-hover">
                    <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center space-x-3 flex-1 min-w-0">
                            <div className="bg-gradient-to-br from-blue-500 to-blue-600 p-3 rounded-full shadow-lg relative">
                                <Plane className="w-5 h-5 text-white" />
                                {flug.status === 'Aktiv' && (
                                    <div className="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full live-indicator"></div>
                                )}
                            </div>
                            <div className="min-w-0 flex-1">
                                <div className="flex items-center space-x-2 mb-1">
                                    <h3 className="font-bold text-lg text-gray-800 truncate">{flug.flugnummer}</h3>
                                    {flug.land && isNonSchengenCountry(flug.land) && (
                                        <span className="px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full whitespace-nowrap">
                                            Non-Schengen
                                        </span>
                                    )}
                                    {flug.versp√§tung && (
                                        <span className="px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full whitespace-nowrap">
                                            +{flug.versp√§tung}min
                                        </span>
                                    )}
                                </div>
                                <p className="text-sm text-gray-500 truncate">{flug.airline}</p>
                                {(flug.altitude || flug.velocity) && (
                                    <div className="flex items-center space-x-3 text-xs text-gray-400 mt-1">
                                        {flug.altitude && (
                                            <span>‚Üó {flug.altitude}ft</span>
                                        )}
                                        {flug.velocity && (
                                            <span>‚ö° {flug.velocity}kt</span>
                                        )}
                                    </div>
                                )}
                                {activeTab === 'sichtkontrollen' && flug.land && (
                                    <p className="text-xs text-blue-600 font-medium flex items-center mt-1">
                                        <Globe className="w-3 h-3 mr-1" />
                                        {flug.land}
                                    </p>
                                )}
                            </div>
                        </div>
                        <button
                            onClick={() => toggleFavorite(flug.id)}
                            className="p-2 rounded-full hover:bg-gray-50 transition-colors flex-shrink-0"
                        >
                            {isFavorite(flug.id) ? 
                                <Star className="w-5 h-5 text-yellow-500 fill-current" /> : 
                                <Star className="w-5 h-5 text-gray-400" />
                            }
                        </button>
                    </div>

                    <div className="grid grid-cols-2 gap-4 mb-3">
                        <div className="flex items-center space-x-3">
                            <div className="p-2 bg-gray-50 rounded-lg">
                                <MapPin className="w-4 h-4 text-gray-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                                <p className="text-xs text-gray-500 mb-0.5">
                                    {flug.isLanding ? 'Von' : 'Nach'}
                                </p>
                                <p className="font-semibold text-sm text-gray-800 truncate">
                                    {flug.zielort || flug.herkunft}
                                </p>
                                <p className="text-xs text-gray-500">
                                    {flug.zielCode || flug.herkunftCode}
                                </p>
                            </div>
                        </div>
                        
                        <div className="flex items-center space-x-3">
                            <div className="p-2 bg-gray-50 rounded-lg">
                                <Clock className="w-4 h-4 text-gray-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                                <p className="text-xs text-gray-500 mb-0.5">
                                    {flug.isLanding ? 'Ankunft' : 'Abflug'}
                                </p>
                                <p className="font-bold text-sm text-gray-800">
                                    {flug.abflug || flug.ankunft}
                                </p>
                                {(flug.abflugErwartet || flug.ankunftErwartet) && (
                                    <p className="text-xs text-orange-600">
                                        Erwartet: {flug.abflugErwartet || flug.ankunftErwartet}
                                    </p>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="flex justify-between items-center pt-3 border-t border-gray-100">
                        <div className="flex items-center space-x-4">
                            <div className="text-sm">
                                <span className="text-gray-500">Gate: </span>
                                <span className="font-semibold text-gray-800 bg-gray-100 px-2 py-1 rounded">
                                    {flug.gate}
                                </span>
                            </div>
                            
                            {flug.isLanding && flug.passagiere && (
                                <div className="flex items-center space-x-1 text-sm">
                                    <Users className="w-4 h-4 text-gray-400" />
                                    <span className="font-semibold text-gray-800">{flug.passagiere}</span>
                                </div>
                            )}
                        </div>
                        
                        <div className="text-sm flex items-center space-x-1">
                            {flug.status === 'Gelandet' && <CheckCircle className="w-4 h-4 text-green-600" />}
                            {flug.status === 'Aktiv' && <Signal className="w-4 h-4 text-blue-600" />}
                            <span className={`font-semibold ${flug.statusColor}`}>
                                {flug.status}
                            </span>
                        </div>
                    </div>

                    {activeTab === 'sichtkontrollen' && (
                        <div className="mt-3 pt-3 border-t border-gray-200">
                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                Bemerkungen zur Sichtkontrolle:
                            </label>
                            <textarea
                                value={getBemerkung(flug.id)}
                                onChange={(e) => updateBemerkung(flug.id, e.target.value)}
                                placeholder="Bemerkungen eingeben..."
                                className="w-full p-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                rows="2"
                            />
                        </div>
                    )}
                </div>
            );

            debugLog('Render App', { flightsCount: flights.length, loading, error, dataSource });

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Mobile Header */}
                    <div className="gradient-bg text-white shadow-xl sticky top-0 z-50">
                        <div className="px-4 py-4">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-xl font-bold flex items-center">
                                        üõ´ DUS Flughafen
                                        {!error && flights.length > 0 && (
                                            <span className="ml-2 px-2 py-1 bg-green-500 text-white text-xs rounded-full live-indicator">
                                                {dataSource === 'opensky' ? 'LIVE' : 'DEMO'}
                                            </span>
                                        )}
                                    </h1>
                                    <p className="text-xs text-blue-100">
                                        {dataSource === 'opensky' ? 'üõ∞Ô∏è OpenSky Network' : 'üéØ Demo-Daten'} ‚Ä¢ Flugdaten
                                    </p>
                                </div>
                                <div className="flex items-center space-x-2">
                                    <button
                                        onClick={() => setShowSearch(!showSearch)}
                                        className="p-2 glass-effect hover:bg-white hover:bg-opacity-20 rounded-lg transition-all"
                                    >
                                        <Search className="w-4 h-4" />
                                    </button>
                                    <button
                                        onClick={loadFlightData}
                                        disabled={loading}
                                        className="p-2 glass-effect hover:bg-white hover:bg-opacity-20 disabled:bg-opacity-10 rounded-lg transition-all"
                                    >
                                        <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />
                                    </button>
                                    <button
                                        onClick={showDebug}
                                        className="p-2 glass-effect hover:bg-white hover:bg-opacity-20 rounded-lg transition-all"
                                        title="Debug anzeigen"
                                    >
                                        <AlertCircle className="w-4 h-4" />
                                    </button>
                                </div>
                            </div>

                            {showSearch && (
                                <div className="mt-3">
                                    <div className="relative">
                                        <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-blue-300" />
                                        <input
                                            type="text"
                                            placeholder="Flug, Airline oder Ziel suchen..."
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            className="w-full pl-10 pr-10 py-2 text-sm glass-effect text-white placeholder-blue-200 rounded-lg focus:ring-2 focus:ring-white focus:ring-opacity-30"
                                        />
                                        <button
                                            onClick={() => setShowSearch(false)}
                                            className="absolute right-2 top-1/2 transform -translate-y-1/2 p-1"
                                        >
                                            <X className="w-4 h-4 text-blue-300" />
                                        </button>
                                    </div>
                                </div>
                            )}

                            <div className="mt-2 flex items-center justify-between text-xs">
                                <div className="flex items-center space-x-2">
                                    {error ? (
                                        <WifiOff className="w-3 h-3 text-red-300" />
                                    ) : (
                                        <Wifi className="w-3 h-3 text-green-300" />
                                    )}
                                    <span className="text-blue-100">
                                        {loading ? 'L√§dt...' : error ? 'Offline' : `${flights.length} Fl√ºge ${dataSource === 'opensky' ? 'live' : 'demo'}`}
                                    </span>
                                </div>
                                {lastUpdate && (
                                    <span className="text-blue-200">
                                        {lastUpdate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}
                                    </span>
                                )}
                            </div>
                        </div>

                        {/* Mobile Tabs */}
                        <div className="px-2 pb-2">
                            <div className="flex space-x-1">
                                {[
                                    { key: 'ank√ºnfte', label: 'Ank√ºnfte', icon: 'üõ¨' },
                                    { key: 'abfl√ºge', label: 'Abfl√ºge', icon: '‚úàÔ∏è' },
                                    { key: 'sichtkontrollen', label: 'Kontrollen', icon: 'üõÇ' },
                                    { key: 'favoriten', label: 'Favoriten', icon: '‚≠ê' }
                                ].map(tab => (
                                    <button
                                        key={tab.key}
                                        onClick={() => setActiveTab(tab.key)}
                                        className={`flex-1 py-3 px-2 rounded-lg text-xs font-medium transition-all ${
                                            activeTab === tab.key
                                                ? 'bg-white text-blue-600 shadow-lg transform scale-105'
                                                : 'text-blue-100 hover:text-white hover:bg-white hover:bg-opacity-20'
                                        }`}
                                    >
                                        <div className="flex flex-col items-center space-y-1">
                                            <span className="text-base">{tab.icon}</span>
                                            <span className="truncate">{tab.label}</span>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="px-4 py-4">
                        {/* Data Source Info */}
                        {dataSource && !error && (
                            <div className="mb-4 p-3 bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-lg">
                                <div className="flex items-center justify-between text-sm">
                                    <div className="flex items-center space-x-2">
                                        <span className="text-lg">{dataSource === 'opensky' ? 'üõ∞Ô∏è' : 'üéØ'}</span>
                                        <div>
                                            <div className="font-medium text-gray-800">
                                                {dataSource === 'opensky' ? 'OpenSky Network' : 'Demo-Modus'}
                                            </div>
                                            <div className="text-xs text-gray-600">
                                                {dataSource === 'opensky' ? 'Echte Flugdaten' : 'Simulierte Flugdaten f√ºr Demo'}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex items-center space-x-1">
                                        <Signal className="w-4 h-4 text-green-500" />
                                        <span className="text-xs font-medium text-green-600">
                                            {dataSource === 'opensky' ? 'LIVE' : 'DEMO'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Sichtkontrollen Filter */}
                        {activeTab === 'sichtkontrollen' && (
                            <div className="mb-6">
                                <button
                                    onClick={() => setShowFilters(!showFilters)}
                                    className="w-full flex justify-between items-center p-4 bg-gradient-to-r from-orange-50 to-orange-100 border border-orange-200 rounded-xl shadow-sm"
                                >
                                    <div className="text-left">
                                        <div className="font-semibold text-orange-800 text-sm flex items-center">
                                            üõÇ Sichtkontrollen
                                        </div>
                                        <div className="text-xs text-orange-600 mt-1">
                                            {selectedAirports.size} Flugh√§fen ‚Ä¢ {selectedFlightsForControl.size} Zusatz-Fl√ºge
                                        </div>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <Filter className="w-4 h-4 text-orange-600" />
                                        {showFilters ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />}
                                    </div>
                                </button>

                                {showFilters && (
                                    <div className="mt-3 space-y-3">
                                        <div className="p-4 bg-orange-50 border border-orange-200 rounded-xl">
                                            <h4 className="font-medium text-orange-800 text-sm mb-3 flex items-center">
                                                üìç Standard-Flugh√§fen
                                            </h4>
                                            <div className="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto">
                                                {Object.entries(DEFAULT_SICHTKONTROLL_AIRPORTS).map(([code, name]) => (
                                                    <label key={code} className="flex items-center space-x-2 p-2 hover:bg-orange-100 rounded-lg cursor-pointer transition-colors">
                                                        <input
                                                            type="checkbox"
                                                            checked={selectedAirports.has(code)}
                                                            onChange={() => toggleAirportForControl(code)}
                                                            className="w-4 h-4 text-orange-600 rounded focus:ring-orange-500"
                                                        />
                                                        <div className="text-xs min-w-0 flex-1">
                                                            <div className="font-medium text-gray-900 truncate">{code}</div>
                                                            <div className="text-gray-600 truncate">{name}</div>
                                                        </div>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>

                                        {getArrivingFlights().length > 0 && (
                                            <div className="p-4 bg-green-50 border border-green-200 rounded-xl">
                                                <h4 className="font-medium text-green-800 text-sm mb-3 flex items-center">
                                                    ‚úàÔ∏è Einzelfl√ºge hinzuf√ºgen
                                                </h4>
                                                <div className="space-y-2 max-h-40 overflow-y-auto">
                                                    {getArrivingFlights().slice(0, 8).map(flight => (
                                                        <label key={flight.id} className="flex items-center space-x-2 p-2 hover:bg-green-100 rounded-lg cursor-pointer transition-colors">
                                                            <input
                                                                type="checkbox"
                                                                checked={selectedFlightsForControl.has(flight.id)}
                                                                onChange={() => toggleFlightForControl(flight.id)}
                                                                className="w-4 h-4 text-green-600 rounded focus:ring-green-500"
                                                            />
                                                            <div className="text-xs min-w-0 flex-1">
                                                                <div className="flex items-center space-x-1">
                                                                    <span className="font-medium text-gray-900">{flight.flugnummer}</span>
                                                                    {flight.land && isNonSchengenCountry(flight.land) && (
                                                                        <span className="px-1 py-0.5 bg-red-100 text-red-600 text-xs rounded-full">NS</span>
                                                                    )}
                                                                </div>
                                                                <div className="text-gray-600 truncate">
                                                                    {flight.herkunft} ‚Ä¢ Gate {flight.gate}
                                                                </div>
                                                            </div>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Flight List */}
                        {loading ? (
                            <div className="text-center py-16">
                                <div className="inline-block p-6 bg-white rounded-2xl shadow-lg">
                                    <RefreshCw className="w-8 h-8 mx-auto mb-4 animate-spin text-blue-500" />
                                    <p className="text-sm text-gray-600">Lade Flugdaten...</p>
                                    <p className="text-xs text-gray-400 mt-2">Versuche echte APIs, dann Demo-Daten</p>
                                </div>
                            </div>
                        ) : error ? (
                            <div className="text-center py-16">
                                <div className="text-red-400 mb-4">
                                    <AlertCircle className="w-12 h-12 mx-auto mb-4" />
                                    <p className="text-base font-medium">Daten nicht verf√ºgbar</p>
                                    <p className="text-sm mt-2 text-gray-600">{error}</p>
                                    <button
                                        onClick={loadFlightData}
                                        className="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                    >
                                        Erneut versuchen
                                    </button>
                                </div>
                            </div>
                        ) : filteredFlights.length > 0 ? (
                            <div>
                                <div className="mb-4 text-sm text-gray-600 bg-white p-3 rounded-lg border flex items-center justify-between">
                                    <span>üìä {filteredFlights.length} {activeTab === 'sichtkontrollen' ? 'kontrollpflichtige ' : ''}Fl√ºge</span>
                                    <div className="flex items-center space-x-1 text-xs">
                                        <span className="text-green-600 font-medium">
                                            {dataSource === 'opensky' ? 'LIVE' : 'DEMO'}
                                        </span>
                                    </div>
                                </div>
                                {filteredFlights.map(flug => (
                                    <FlugKarte key={flug.id} flug={flug} />
                                ))}
                            </div>
                        ) : (
                            <div className="text-center py-16">
                                <div className="inline-block p-8 bg-white rounded-2xl shadow-lg">
                                    <div className="text-gray-400 mb-4">
                                        <Plane className="w-12 h-12 mx-auto mb-4 opacity-50" />
                                        <p className="text-base">
                                            {activeTab === 'favoriten' && favorites.length === 0
                                                ? 'Keine Favoriten markiert'
                                                : searchTerm
                                                ? 'Keine Fl√ºge gefunden'
                                                : 'Keine Fl√ºge verf√ºgbar'
                                            }
                                        </p>
                                        {activeTab === 'favoriten' && favorites.length === 0 && (
                                            <p className="text-sm mt-2 text-gray-500">
                                                Markiere Fl√ºge mit ‚≠ê als Favoriten
                                            </p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Footer */}
                        <div className="mt-12 pt-6 border-t border-gray-200 text-center text-gray-500">
                            <div className="bg-white p-4 rounded-xl shadow-sm">
                                <p className="text-xs font-medium flex items-center justify-center space-x-1">
                                    <span>üõ´ D√ºsseldorf Flughafen (DUS)</span>
                                    <span>‚Ä¢</span>
                                    <span className={dataSource === 'opensky' ? 'text-green-600' : 'text-blue-600'}>
                                        {dataSource === 'opensky' ? 'ECHTE DATEN' : 'DEMO-MODUS'}
                                    </span>
                                </p>
                                <p className="text-xs mt-1">
                                    Quelle: {dataSource === 'opensky' ? 'OpenSky Network' : 'Simulierte Daten'} ‚Ä¢ Updates alle 60s
                                </p>
                                <div className="flex items-center justify-center space-x-2 mt-2">
                                    <Signal className="w-3 h-3 text-green-500" />
                                    <span className="text-xs text-green-600">
                                        {dataSource === 'opensky' ? 'Live-Tracking' : 'Demo aktiv'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // App rendern
        debugLog('Rendere React App...');
        try {
            ReactDOM.render(<FlugInfoApp />, document.getElementById('root'));
            debugLog('‚úÖ React App erfolgreich gerendert');
        } catch (renderError) {
            debugLog('‚ùå React Render Fehler:', renderError.message);
            document.getElementById('root').innerHTML = `
                <div style="padding: 20px; text-align: center; color: red;">
                    <h1>üö´ Fehler beim Laden der App</h1>
                    <p>JavaScript Fehler: ${renderError.message}</p>
                    <p>Siehe Browser-Konsole f√ºr Details</p>
                </div>
            `;
        }
    </script>
</body>
</html>
