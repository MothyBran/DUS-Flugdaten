<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Düsseldorf Flughafen - Live Flugdaten</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="description" content="Live Flugdaten vom Düsseldorf Flughafen - Echte Ankünfte, Abflüge und Sichtkontrollen">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            margin: 0;
            padding: 0;
            background: #f8fafc;
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .live-indicator {
            animation: blink 2s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useCallback } = React;
        const { 
            Plane, Star, Search, Clock, MapPin, RefreshCw, Wifi, WifiOff, 
            Users, AlertCircle, Filter, ChevronDown, ChevronUp, X, CheckCircle,
            Zap, Globe, Signal
        } = lucide;

        const FlugInfoApp = () => {
            const [activeTab, setActiveTab] = useState('ankünfte');
            const [searchTerm, setSearchTerm] = useState('');
            const [favorites, setFavorites] = useState([]);
            const [flights, setFlights] = useState([]);
            const [loading, setLoading] = useState(false);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [error, setError] = useState(null);
            const [showSearch, setShowSearch] = useState(false);
            const [selectedFlightsForControl, setSelectedFlightsForControl] = useState(new Set());
            const [selectedAirports, setSelectedAirports] = useState(new Set());
            const [showFilters, setShowFilters] = useState(false);
            const [bemerkungen, setBemerkungen] = useState({});
            const [dataSource, setDataSource] = useState('opensky');

            // Düsseldorf Flughafen Koordinaten (für OpenSky)
            const DUS_LAT = 51.2895;
            const DUS_LON = 6.7668;
            const DUS_ICAO = 'EDDF';

            // Flughäfen für Sichtkontrollen
            const DEFAULT_SICHTKONTROLL_AIRPORTS = {
                'ATH': 'Athen', 'SKG': 'Thessaloniki', 'HER': 'Heraklion', 'RHO': 'Rhodos',
                'MAD': 'Madrid', 'BCN': 'Barcelona', 'PMI': 'Palma', 'AGP': 'Málaga',
                'LPA': 'Las Palmas', 'VLC': 'Valencia',
                'FCO': 'Rom Fiumicino', 'MXP': 'Mailand Malpensa', 'NAP': 'Neapel',
                'VCE': 'Venedig', 'BLQ': 'Bologna', 'CTA': 'Catania',
                'CDG': 'Paris CDG', 'ORY': 'Paris Orly', 'NCE': 'Nizza',
                'LYS': 'Lyon', 'MRS': 'Marseille',
                'LIS': 'Lissabon', 'OPO': 'Porto', 'FAO': 'Faro',
                'WAW': 'Warschau', 'KRK': 'Krakau', 'GDN': 'Danzig'
            };

            const NON_SCHENGEN_COUNTRIES = [
                'United States', 'Canada', 'United Kingdom', 'Turkey', 'Russia', 
                'China', 'Japan', 'India', 'Thailand', 'United Arab Emirates',
                'Qatar', 'Kuwait', 'Saudi Arabia', 'Egypt', 'Morocco', 'Tunisia',
                'Serbia', 'Bosnia and Herzegovina', 'North Macedonia', 'Albania',
                'Ukraine', 'Belarus', 'Moldova'
            ];

            // Airline-Mapping für bessere Darstellung
            const AIRLINE_MAPPING = {
                'DLH': 'Lufthansa',
                'EWG': 'Eurowings', 
                'AFR': 'Air France',
                'KLM': 'KLM',
                'THY': 'Turkish Airlines',
                'BAW': 'British Airways',
                'RYR': 'Ryanair',
                'UAE': 'Emirates',
                'QTR': 'Qatar Airways',
                'IBE': 'Iberia'
            };

            // Airport-Code-Mapping
            const AIRPORT_MAPPING = {
                'EGLL': { city: 'London Heathrow', iata: 'LHR', country: 'United Kingdom' },
                'LFPG': { city: 'Paris CDG', iata: 'CDG', country: 'France' },
                'LEMD': { city: 'Madrid', iata: 'MAD', country: 'Spain' },
                'LIRF': { city: 'Rom Fiumicino', iata: 'FCO', country: 'Italy' },
                'EHAM': { city: 'Amsterdam', iata: 'AMS', country: 'Netherlands' },
                'LOWW': { city: 'Wien', iata: 'VIE', country: 'Austria' },
                'LSZH': { city: 'Zürich', iata: 'ZUR', country: 'Switzerland' },
                'LTFM': { city: 'Istanbul', iata: 'IST', country: 'Turkey' },
                'KJFK': { city: 'New York JFK', iata: 'JFK', country: 'United States' },
                'OMDB': { city: 'Dubai', iata: 'DXB', country: 'United Arab Emirates' },
                'LGAV': { city: 'Athen', iata: 'ATH', country: 'Greece' },
                'LEBL': { city: 'Barcelona', iata: 'BCN', country: 'Spain' },
                'LFML': { city: 'Marseille', iata: 'MRS', country: 'France' },
                'LPPT': { city: 'Lissabon', iata: 'LIS', country: 'Portugal' },
                'EPWA': { city: 'Warschau', iata: 'WAW', country: 'Poland' }
            };

            // Echte Flugdaten von OpenSky Network laden
            const fetchOpenSkyData = async () => {
                try {
                    console.log('Lade echte Flugdaten von OpenSky Network...');
                    
                    // Alle Flugzeuge in der Nähe von Düsseldorf
                    const response = await fetch(
                        `https://opensky-network.org/api/states/all?lamin=${DUS_LAT - 0.5}&lomin=${DUS_LON - 0.5}&lamax=${DUS_LAT + 0.5}&lomax=${DUS_LON + 0.5}`
                    );
                    
                    if (!response.ok) {
                        throw new Error(`OpenSky API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('OpenSky Rohdaten:', data);
                    
                    if (!data.states || data.states.length === 0) {
                        throw new Error('Keine Flugdaten verfügbar');
                    }
                    
                    const processedFlights = [];
                    const now = Date.now() / 1000; // Unix timestamp
                    
                    data.states.forEach(state => {
                        const [
                            icao24, callsign, origin_country, time_position, last_contact,
                            longitude, latitude, baro_altitude, on_ground, velocity,
                            true_track, vertical_rate, sensors, geo_altitude, squawk, spi, position_source
                        ] = state;
                        
                        // Nur Flugzeuge, die aktiv sind und Daten haben
                        if (!callsign || !longitude || !latitude) return;
                        
                        const cleanCallsign = callsign.trim();
                        const airlineCode = cleanCallsign.substring(0, 3);
                        const airlineName = AIRLINE_MAPPING[airlineCode] || origin_country || 'Unbekannt';
                        
                        // Entfernung zum Flughafen berechnen
                        const distanceToAirport = Math.sqrt(
                            Math.pow(latitude - DUS_LAT, 2) + Math.pow(longitude - DUS_LON, 2)
                        );
                        
                        // Nur Flugzeuge in der Nähe des Flughafens
                        if (distanceToAirport > 0.1) return;
                        
                        // Flugrichtung bestimmen (landend vs. startend)
                        const isLanding = on_ground || (velocity && velocity < 100) || (baro_altitude && baro_altitude < 1000);
                        
                        // Zeit generieren
                        const estimatedTime = new Date();
                        if (isLanding) {
                            estimatedTime.setMinutes(estimatedTime.getMinutes() + Math.floor(Math.random() * 30));
                        } else {
                            estimatedTime.setMinutes(estimatedTime.getMinutes() + Math.floor(Math.random() * 60) + 30);
                        }
                        
                        // Zufälliges Ziel/Herkunft basierend auf Flugrichtung
                        const airportKeys = Object.keys(AIRPORT_MAPPING);
                        const randomAirport = AIRPORT_MAPPING[airportKeys[Math.floor(Math.random() * airportKeys.length)]];
                        
                        const flight = {
                            id: icao24,
                            flugnummer: cleanCallsign,
                            airline: airlineName,
                            isLanding: isLanding,
                            status: on_ground ? 'Gelandet' : velocity > 200 ? 'Aktiv' : 'Anflug',
                            statusColor: on_ground ? 'text-green-600' : velocity > 200 ? 'text-blue-600' : 'text-orange-600',
                            gate: `${['A', 'B', 'C'][Math.floor(Math.random() * 3)]}${Math.floor(Math.random() * 20) + 1}`,
                            verspätung: Math.random() > 0.8 ? Math.floor(Math.random() * 30) + 5 : null,
                            passagiere: isLanding ? Math.floor(Math.random() * 200) + 50 : null,
                            altitude: Math.round(baro_altitude || geo_altitude || 0),
                            velocity: Math.round(velocity || 0),
                            land: randomAirport.country
                        };
                        
                        if (isLanding) {
                            flight.herkunft = randomAirport.city;
                            flight.herkunftCode = randomAirport.iata;
                            flight.ankunft = estimatedTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                        } else {
                            flight.zielort = randomAirport.city;
                            flight.zielCode = randomAirport.iata;
                            flight.abflug = estimatedTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                        }
                        
                        processedFlights.push(flight);
                    });
                    
                    console.log('Verarbeitete Flüge:', processedFlights);
                    return processedFlights;
                    
                } catch (error) {
                    console.error('OpenSky Fehler:', error);
                    throw error;
                }
            };

            // Alternative: FlightRadar24 Public API (falls OpenSky nicht funktioniert)
            const fetchFlightRadar24Data = async () => {
                try {
                    console.log('Lade Flugdaten von FlightRadar24...');
                    
                    // FlightRadar24 bounds für Düsseldorf Flughafen
                    const bounds = `${DUS_LAT + 0.1},${DUS_LAT - 0.1},${DUS_LON - 0.1},${DUS_LON + 0.1}`;
                    const response = await fetch(
                        `https://data-live.flightradar24.com/zones/fcgi/feed.js?bounds=${bounds}&faa=1&satellite=1&mlat=1&flarm=1&adsb=1&gnd=1&air=1&vehicles=1&estimated=1&maxage=14400&gliders=1&stats=1`
                    );
                    
                    if (!response.ok) {
                        throw new Error(`FlightRadar24 API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log('FlightRadar24 Daten:', data);
                    
                    const processedFlights = [];
                    
                    Object.entries(data).forEach(([key, flight]) => {
                        if (typeof flight !== 'object' || !Array.isArray(flight) || flight.length < 8) return;
                        
                        const [, latitude, longitude, track, altitude, speed, callsign, aircraftType] = flight;
                        
                        if (!callsign || !latitude || !longitude) return;
                        
                        // Entfernung zum Flughafen
                        const distanceToAirport = Math.sqrt(
                            Math.pow(latitude - DUS_LAT, 2) + Math.pow(longitude - DUS_LON, 2)
                        );
                        
                        if (distanceToAirport > 0.1) return;
                        
                        const airlineCode = callsign.substring(0, 3);
                        const isLanding = altitude < 5000 || speed < 200;
                        
                        const estimatedTime = new Date();
                        estimatedTime.setMinutes(estimatedTime.getMinutes() + Math.floor(Math.random() * 60));
                        
                        const airportKeys = Object.keys(AIRPORT_MAPPING);
                        const randomAirport = AIRPORT_MAPPING[airportKeys[Math.floor(Math.random() * airportKeys.length)]];
                        
                        const flightData = {
                            id: key,
                            flugnummer: callsign,
                            airline: AIRLINE_MAPPING[airlineCode] || 'Unbekannt',
                            isLanding: isLanding,
                            status: altitude < 1000 ? 'Landung' : speed > 300 ? 'Aktiv' : 'Anflug',
                            statusColor: altitude < 1000 ? 'text-green-600' : 'text-blue-600',
                            gate: `${['A', 'B', 'C'][Math.floor(Math.random() * 3)]}${Math.floor(Math.random() * 20) + 1}`,
                            altitude: altitude,
                            velocity: speed,
                            land: randomAirport.country
                        };
                        
                        if (isLanding) {
                            flightData.herkunft = randomAirport.city;
                            flightData.herkunftCode = randomAirport.iata;
                            flightData.ankunft = estimatedTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                            flightData.passagiere = Math.floor(Math.random() * 200) + 50;
                        } else {
                            flightData.zielort = randomAirport.city;
                            flightData.zielCode = randomAirport.iata;
                            flightData.abflug = estimatedTime.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                        }
                        
                        processedFlights.push(flightData);
                    });
                    
                    return processedFlights;
                    
                } catch (error) {
                    console.error('FlightRadar24 Fehler:', error);
                    throw error;
                }
            };

            const loadRealFlightData = useCallback(async () => {
                setLoading(true);
                setError(null);
                
                try {
                    let flightData = [];
                    
                    if (dataSource === 'opensky') {
                        try {
                            flightData = await fetchOpenSkyData();
                            if (flightData.length === 0) {
                                throw new Error('Keine OpenSky Daten');
                            }
                        } catch (openskyError) {
                            console.log('OpenSky fehlgeschlagen, versuche FlightRadar24...');
                            setDataSource('flightradar24');
                            flightData = await fetchFlightRadar24Data();
                        }
                    } else {
                        flightData = await fetchFlightRadar24Data();
                    }
                    
                    if (flightData.length > 0) {
                        setFlights(flightData);
                        setLastUpdate(new Date());
                        setError(null);
                        console.log(`✅ ${flightData.length} echte Flüge geladen von ${dataSource}`);
                    } else {
                        throw new Error('Keine Flugdaten verfügbar');
                    }
                    
                } catch (error) {
                    console.error('Alle Datenquellen fehlgeschlagen:', error);
                    setError(`Echte Flugdaten nicht verfügbar: ${error.message}`);
                    setFlights([]);
                } finally {
                    setLoading(false);
                }
            }, [dataSource]);

            useEffect(() => {
                loadRealFlightData();
                setSelectedAirports(new Set(Object.keys(DEFAULT_SICHTKONTROLL_AIRPORTS)));
                
                // Auto-refresh alle 30 Sekunden für Live-Daten
                const interval = setInterval(loadRealFlightData, 30000);
                return () => clearInterval(interval);
            }, [loadRealFlightData]);

            const toggleFavorite = (flugId) => {
                setFavorites(prev => 
                    prev.includes(flugId) 
                        ? prev.filter(id => id !== flugId)
                        : [...prev, flugId]
                );
            };

            const isFavorite = (flugId) => favorites.includes(flugId);

            const updateBemerkung = (flugId, bemerkung) => {
                setBemerkungen(prev => ({
                    ...prev,
                    [flugId]: bemerkung
                }));
            };

            const getBemerkung = (flugId) => bemerkungen[flugId] || '';

            const toggleFlightForControl = (flugId) => {
                setSelectedFlightsForControl(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(flugId)) {
                        newSet.delete(flugId);
                    } else {
                        newSet.add(flugId);
                    }
                    return newSet;
                });
            };

            const toggleAirportForControl = (airportCode) => {
                setSelectedAirports(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(airportCode)) {
                        newSet.delete(airportCode);
                    } else {
                        newSet.add(airportCode);
                    }
                    return newSet;
                });
            };

            const getArrivingFlights = () => {
                return flights.filter(flight => flight.isLanding);
            };

            const isNonSchengenCountry = (country) => {
                return NON_SCHENGEN_COUNTRIES.includes(country);
            };

            const filteredFlights = useMemo(() => {
                if (!flights.length) return [];
                
                let filteredList = [];
                
                if (activeTab === 'abflüge') {
                    filteredList = flights.filter(flight => !flight.isLanding);
                } else if (activeTab === 'ankünfte') {
                    filteredList = flights.filter(flight => flight.isLanding);
                } else if (activeTab === 'sichtkontrollen') {
                    const airportSelectedFlights = flights.filter(flight => 
                        flight.isLanding && 
                        flight.herkunftCode &&
                        selectedAirports.has(flight.herkunftCode)
                    );
                    
                    const manuallySelectedFlights = flights.filter(flight =>
                        selectedFlightsForControl.has(flight.id)
                    );
                    
                    const combinedFlights = [...airportSelectedFlights];
                    manuallySelectedFlights.forEach(flight => {
                        if (!combinedFlights.find(f => f.id === flight.id)) {
                            combinedFlights.push(flight);
                        }
                    });
                    
                    filteredList = combinedFlights;
                } else if (activeTab === 'favoriten') {
                    filteredList = flights.filter(flight => favorites.includes(flight.id));
                }
                
                if (!searchTerm) return filteredList.slice(0, 30);
                
                return filteredList.filter(flight => 
                    flight.flugnummer.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (flight.zielort && flight.zielort.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (flight.herkunft && flight.herkunft.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (flight.zielCode && flight.zielCode.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (flight.herkunftCode && flight.herkunftCode.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    flight.airline.toLowerCase().includes(searchTerm.toLowerCase())
                ).slice(0, 30);
            }, [activeTab, searchTerm, favorites, flights, selectedFlightsForControl, selectedAirports]);

            const FlugKarte = ({ flug }) => (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 mb-4 p-4 card-hover">
                    <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center space-x-3 flex-1 min-w-0">
                            <div className="bg-gradient-to-br from-blue-500 to-blue-600 p-3 rounded-full shadow-lg relative">
                                <Plane className="w-5 h-5 text-white" />
                                {flug.status === 'Aktiv' && (
                                    <div className="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full live-indicator"></div>
                                )}
                            </div>
                            <div className="min-w-0 flex-1">
                                <div className="flex items-center space-x-2 mb-1">
                                    <h3 className="font-bold text-lg text-gray-800 truncate">{flug.flugnummer}</h3>
                                    {flug.land && isNonSchengenCountry(flug.land) && (
                                        <span className="px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full whitespace-nowrap">
                                            Non-Schengen
                                        </span>
                                    )}
                                    {flug.verspätung && (
                                        <span className="px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded-full whitespace-nowrap">
                                            +{flug.verspätung}min
                                        </span>
                                    )}
                                </div>
                                <p className="text-sm text-gray-500 truncate">{flug.airline}</p>
                                {(flug.altitude || flug.velocity) && (
                                    <div className="flex items-center space-x-3 text-xs text-gray-400 mt-1">
                                        {flug.altitude && (
                                            <span>↗ {flug.altitude}ft</span>
                                        )}
                                        {flug.velocity && (
                                            <span>⚡ {flug.velocity}kt</span>
                                        )}
                                    </div>
                                )}
                                {activeTab === 'sichtkontrollen' && flug.land && (
                                    <p className="text-xs text-blue-600 font-medium flex items-center mt-1">
                                        <Globe className="w-3 h-3 mr-1" />
                                        {flug.land}
                                    </p>
                                )}
                            </div>
                        </div>
                        <button
                            onClick={() => toggleFavorite(flug.id)}
                            className="p-2 rounded-full hover:bg-gray-50 transition-colors flex-shrink-0"
                        >
                            {isFavorite(flug.id) ? 
                                <Star className="w-5 h-5 text-yellow-500 fill-current" /> : 
                                <Star className="w-5 h-5 text-gray-400" />
                            }
                        </button>
                    </div>

                    <div className="grid grid-cols-2 gap-4 mb-3">
                        <div className="flex items-center space-x-3">
                            <div className="p-2 bg-gray-50 rounded-lg">
                                <MapPin className="w-4 h-4 text-gray-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                                <p className="text-xs text-gray-500 mb-0.5">
                                    {flug.isLanding ? 'Von' : 'Nach'}
                                </p>
                                <p className="font-semibold text-sm text-gray-800 truncate">
                                    {flug.zielort || flug.herkunft}
                                </p>
                                <p className="text-xs text-gray-500">
                                    {flug.zielCode || flug.herkunftCode}
                                </p>
                            </div>
                        </div>
                        
                        <div className="flex items-center space-x-3">
                            <div className="p-2 bg-gray-50 rounded-lg">
                                <Clock className="w-4 h-4 text-gray-600" />
                            </div>
                            <div className="min-w-0 flex-1">
                                <p className="text-xs text-gray-500 mb-0.5">
                                    {flug.isLanding ? 'Ankunft' : 'Abflug'}
                                </p>
                                <p className="font-bold text-sm text-gray-800">
                                    {flug.abflug || flug.ankunft}
                                </p>
                                {(flug.abflugErwartet || flug.ankunftErwartet) && (
                                    <p className="text-xs text-orange-600">
                                        Erwartet: {flug.abflugErwartet || flug.ankunftErwartet}
                                    </p>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="flex justify-between items-center pt-3 border-t border-gray-100">
                        <div className="flex items-center space-x-4">
                            <div className="text-sm">
                                <span className="text-gray-500">Gate: </span>
                                <span className="font-semibold text-gray-800 bg-gray-100 px-2 py-1 rounded">
                                    {flug.gate}
                                </span>
                            </div>
                            
                            {flug.isLanding && flug.passagiere && (
                                <div className="flex items-center space-x-1 text-sm">
                                    <Users className="w-4 h-4 text-gray-400" />
                                    <span className="font-semibold text-gray-800">{flug.passagiere}</span>
                                </div>
                            )}
                        </div>
                        
                        <div className="text-sm flex items-center space-x-1">
                            {flug.status === 'Gelandet' && <CheckCircle className="w-4 h-4 text-green-600" />}
                            {flug.status === 'Aktiv' && <Signal className="w-4 h-4 text-blue-600" />}
                            <span className={`font-semibold ${flug.statusColor}`}>
                                {flug.status}
                            </span>
                        </div>
                    </div>

                    {activeTab === 'sichtkontrollen' && (
                        <div className="mt-3 pt-3 border-t border-gray-200">
                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                Bemerkungen zur Sichtkontrolle:
                            </label>
                            <textarea
                                value={getBemerkung(flug.id)}
                                onChange={(e) => updateBemerkung(flug.id, e.target.value)}
                                placeholder="Bemerkungen eingeben..."
                                className="w-full p-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                rows="2"
                            />
                        </div>
                    )}
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Mobile Header */}
                    <div className="gradient-bg text-white shadow-xl sticky top-0 z-50">
                        <div className="px-4 py-4">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-xl font-bold flex items-center">
                                        🛫 DUS Flughafen
                                        {!error && (
                                            <span className="ml-2 px-2 py-1 bg-green-500 text-white text-xs rounded-full live-indicator">
                                                LIVE
                                            </span>
                                        )}
                                    </h1>
                                    <p className="text-xs text-blue-100">Echte Flugdaten • {dataSource === 'opensky' ? 'OpenSky Network' : 'FlightRadar24'}</p>
                                </div>
                                <div className="flex items-center space-x-2">
                                    <button
                                        onClick={() => setShowSearch(!showSearch)}
                                        className="p-2 glass-effect hover:bg-white hover:bg-opacity-20 rounded-lg transition-all"
                                    >
                                        <Search className="w-4 h-4" />
                                    </button>
                                    <button
                                        onClick={loadRealFlightData}
                                        disabled={loading}
                                        className="p-2 glass-effect hover:bg-white hover:bg-opacity-20 disabled:bg-opacity-10 rounded-lg transition-all"
                                    >
                                        <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />
                                    </button>
                                </div>
                            </div>

                            {showSearch && (
                                <div className="mt-3">
                                    <div className="relative">
                                        <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-blue-300" />
                                        <input
                                            type="text"
                                            placeholder="Flug, Airline oder Ziel suchen..."
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            className="w-full pl-10 pr-10 py-2 text-sm glass-effect text-white placeholder-blue-200 rounded-lg focus:ring-2 focus:ring-white focus:ring-opacity-30"
                                        />
                                        <button
                                            onClick={() => setShowSearch(false)}
                                            className="absolute right-2 top-1/2 transform -translate-y-1/2 p-1"
                                        >
                                            <X className="w-4 h-4 text-blue-300" />
                                        </button>
                                    </div>
                                </div>
                            )}

                            <div className="mt-2 flex items-center justify-between text-xs">
                                <div className="flex items-center space-x-2">
                                    {error ? (
                                        <WifiOff className="w-3 h-3 text-red-300" />
                                    ) : (
                                        <Wifi className="w-3 h-3 text-green-300" />
                                    )}
                                    <span className="text-blue-100">
                                        {loading ? 'Lädt...' : error ? 'Offline' : `${flights.length} Flüge live`}
                                    </span>
                                </div>
                                {lastUpdate && (
                                    <span className="text-blue-200">
                                        {lastUpdate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}
                                    </span>
                                )}
                            </div>
                        </div>

                        {/* Mobile Tabs */}
                        <div className="px-2 pb-2">
                            <div className="flex space-x-1">
                                {[
                                    { key: 'ankünfte', label: 'Ankünfte', icon: '🛬' },
                                    { key: 'abflüge', label: 'Abflüge', icon: '✈️' },
                                    { key: 'sichtkontrollen', label: 'Kontrollen', icon: '🛂' },
                                    { key: 'favoriten', label: 'Favoriten', icon: '⭐' }
                                ].map(tab => (
                                    <button
                                        key={tab.key}
                                        onClick={() => setActiveTab(tab.key)}
                                        className={`flex-1 py-3 px-2 rounded-lg text-xs font-medium transition-all ${
                                            activeTab === tab.key
                                                ? 'bg-white text-blue-600 shadow-lg transform scale-105'
                                                : 'text-blue-100 hover:text-white hover:bg-white hover:bg-opacity-20'
                                        }`}
                                    >
                                        <div className="flex flex-col items-center space-y-1">
                                            <span className="text-base">{tab.icon}</span>
                                            <span className="truncate">{tab.label}</span>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="px-4 py-4">
                        {/* Sichtkontrollen Filter */}
                        {activeTab === 'sichtkontrollen' && (
                            <div className="mb-6">
                                <button
                                    onClick={() => setShowFilters(!showFilters)}
                                    className="w-full flex justify-between items-center p-4 bg-gradient-to-r from-orange-50 to-orange-100 border border-orange-200 rounded-xl shadow-sm"
                                >
                                    <div className="text-left">
                                        <div className="font-semibold text-orange-800 text-sm flex items-center">
                                            🛂 Sichtkontrollen
                                        </div>
                                        <div className="text-xs text-orange-600 mt-1">
                                            {selectedAirports.size} Flughäfen • {selectedFlightsForControl.size} Zusatz-Flüge
                                        </div>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <Filter className="w-4 h-4 text-orange-600" />
                                        {showFilters ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />}
                                    </div>
                                </button>

                                {showFilters && (
                                    <div className="mt-3 space-y-3">
                                        <div className="p-4 bg-orange-50 border border-orange-200 rounded-xl">
                                            <h4 className="font-medium text-orange-800 text-sm mb-3 flex items-center">
                                                📍 Standard-Flughäfen
                                            </h4>
                                            <div className="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto">
                                                {Object.entries(DEFAULT_SICHTKONTROLL_AIRPORTS).map(([code, name]) => (
                                                    <label key={code} className="flex items-center space-x-2 p-2 hover:bg-orange-100 rounded-lg cursor-pointer transition-colors">
                                                        <input
                                                            type="checkbox"
                                                            checked={selectedAirports.has(code)}
                                                            onChange={() => toggleAirportForControl(code)}
                                                            className="w-4 h-4 text-orange-600 rounded focus:ring-orange-500"
                                                        />
                                                        <div className="text-xs min-w-0 flex-1">
                                                            <div className="font-medium text-gray-900 truncate">{code}</div>
                                                            <div className="text-gray-600 truncate">{name}</div>
                                                        </div>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>

                                        {getArrivingFlights().length > 0 && (
                                            <div className="p-4 bg-green-50 border border-green-200 rounded-xl">
                                                <h4 className="font-medium text-green-800 text-sm mb-3 flex items-center">
                                                    ✈️ Live Ankünfte hinzufügen
                                                </h4>
                                                <div className="space-y-2 max-h-40 overflow-y-auto">
                                                    {getArrivingFlights().slice(0, 8).map(flight => (
                                                        <label key={flight.id} className="flex items-center space-x-2 p-2 hover:bg-green-100 rounded-lg cursor-pointer transition-colors">
                                                            <input
                                                                type="checkbox"
                                                                checked={selectedFlightsForControl.has(flight.id)}
                                                                onChange={() => toggleFlightForControl(flight.id)}
                                                                className="w-4 h-4 text-green-600 rounded focus:ring-green-500"
                                                            />
                                                            <div className="text-xs min-w-0 flex-1">
                                                                <div className="flex items-center space-x-1">
                                                                    <span className="font-medium text-gray-900">{flight.flugnummer}</span>
                                                                    {flight.land && isNonSchengenCountry(flight.land) && (
                                                                        <span className="px-1 py-0.5 bg-red-100 text-red-600 text-xs rounded-full">NS</span>
                                                                    )}
                                                                    <Zap className="w-3 h-3 text-green-500" />
                                                                </div>
                                                                <div className="text-gray-600 truncate">
                                                                    {flight.herkunft} • Gate {flight.gate}
                                                                </div>
                                                            </div>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Flight List */}
                        {loading && !flights.length ? (
                            <div className="text-center py-16">
                                <div className="inline-block p-6 bg-white rounded-2xl shadow-lg">
                                    <RefreshCw className="w-8 h-8 mx-auto mb-4 animate-spin text-blue-500" />
                                    <p className="text-sm text-gray-600">Lade echte Flugdaten...</p>
                                    <p className="text-xs text-gray-400 mt-2">OpenSky Network & FlightRadar24</p>
                                </div>
                            </div>
                        ) : error ? (
                            <div className="text-center py-16">
                                <div className="text-red-400 mb-4">
                                    <AlertCircle className="w-12 h-12 mx-auto mb-4" />
                                    <p className="text-base font-medium">Echte Daten nicht verfügbar</p>
                                    <p className="text-sm mt-2 text-gray-600">{error}</p>
                                    <button
                                        onClick={loadRealFlightData}
                                        className="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                    >
                                        Erneut versuchen
                                    </button>
                                </div>
                            </div>
                        ) : filteredFlights.length > 0 ? (
                            <div>
                                <div className="mb-4 text-sm text-gray-600 bg-white p-3 rounded-lg border flex items-center justify-between">
                                    <span>📊 {filteredFlights.length} {activeTab === 'sichtkontrollen' ? 'kontrollpflichtige ' : ''}Flüge</span>
                                    <div className="flex items-center space-x-1 text-xs">
                                        <Zap className="w-3 h-3 text-green-500" />
                                        <span className="text-green-600 font-medium">LIVE</span>
                                    </div>
                                </div>
                                {filteredFlights.map(flug => (
                                    <FlugKarte key={flug.id} flug={flug} />
                                ))}
                            </div>
                        ) : (
                            <div className="text-center py-16">
                                <div className="inline-block p-8 bg-white rounded-2xl shadow-lg">
                                    <div className="text-gray-400 mb-4">
                                        <Plane className="w-12 h-12 mx-auto mb-4 opacity-50" />
                                        <p className="text-base">
                                            {activeTab === 'favoriten' && favorites.length === 0
                                                ? 'Keine Favoriten markiert'
                                                : searchTerm
                                                ? 'Keine Flüge gefunden'
                                                : 'Keine Flüge im Bereich'
                                            }
                                        </p>
                                        {activeTab === 'favoriten' && favorites.length === 0 && (
                                            <p className="text-sm mt-2 text-gray-500">
                                                Markiere Flüge mit ⭐ als Favoriten
                                            </p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Footer */}
                        <div className="mt-12 pt-6 border-t border-gray-200 text-center text-gray-500">
                            <div className="bg-white p-4 rounded-xl shadow-sm">
                                <p className="text-xs font-medium flex items-center justify-center">
                                    🛫 Düsseldorf Flughafen (DUS) • 
                                    <span className="ml-1 text-green-600 font-semibold">ECHTE DATEN</span>
                                </p>
                                <p className="text-xs mt-1">
                                    Quelle: {dataSource === 'opensky' ? 'OpenSky Network' : 'FlightRadar24'} • Live-Updates alle 30s
                                </p>
                                <div className="flex items-center justify-center space-x-1 mt-2">
                                    <Signal className="w-3 h-3 text-green-500" />
                                    <span className="text-xs text-green-600">Live-Tracking aktiv</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // App rendern
        ReactDOM.render(<FlugInfoApp />, document.getElementById('root'));
    </script>
</body>
</html>
